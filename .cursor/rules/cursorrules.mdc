---
alwaysApply: true
---
# ============================================================
#  UCHAKIDE APP MANAGER – CURSOR MASTER RULESET (v6.0 OPTIMIZED)
# ============================================================

runtime:
  priority_mode: performance
  disable_full_context_analysis: true     # Prevent huge slowdowns on large repos
  limit_file_context: true

meta:
  name: "Uchakide App Manager Ruleset"
  version: 6.0
  description: |
    Optimized Cursor ruleset for enterprise React + Node + PostgreSQL.
    Ensures strict schema consistency, RBAC enforcement, modal-first UI,
    and cross-project design uniformity.

# ============================================================
#  PERFORMANCE OPTIMIZATION
# ============================================================

performance:
  cache_scans: true
  cache_reasoning: true
  cache_schema_map: true
  incremental_analysis: true
  max_context_depth: 3
  skip_validation_if_unchanged: true
  prefer_incremental_over_full: true
  skip_large_file_reanalysis: true

reasoning:
  depth_limit: 4
  auto_trust_known_patterns: true
  skip_noncritical_checks: true
  prefer_code_actions_over_explanations: true

ai_behavior:
  verbosity: low
  infer_context_from_path: true
  skip_restatement: true
  avoid_overwrite_unless_confirmed: true
  confirm_destructive_actions: true

# ============================================================
#  GLOBAL DEVELOPMENT PRINCIPLES
# ============================================================

general_guidelines:
  - Maintain full design + logic uniformity across modules.
  - Reference **Applicants module** as canonical structure.
  - Use **Modal-based pages** (NOT drawers).
  - Never break or overwrite production code unless explicitly asked.
  - Confirm when RBAC or schema impact is uncertain.
  - Keep dark/light theme support mandatory.
  - Maintain strict separation of concerns (UI, API, DB, RBAC).

# ============================================================
#  DATABASE / SCHEMA RULES
# ============================================================

database_rules:
  auto_who_columns: true
  who_columns: [created_by, created_at, updated_by, updated_at]

  schema_generation:
    style: mirror_existing_schema
    preserve_existing_constraints: true
    preserve_existing_types: true

  table_creation_rules:
    - Follow reference project naming conventions exactly
    - Primary keys, FKs, indexes required consistently
    - Sub-table → Parent table auto-linking
    - Optional fields must be marked clearly
    - Auto-generate comments describing table purpose & relations
    - Never rename or drop columns without confirmation
    - Ensure PostgreSQL-safe datatypes

  foreign_keys: true
  indexes: follow_reference_style
  constraints: follow_reference_style
  sub_table_links: true
  optional_fields: clearly_marked
  comments: auto_generate_with_description

# Extra SQL protection
sql_safety:
  prevent_dangerous_ops: true
  forbid_drop_column: true
  forbid_mass_schema_changes: true
  require_confirmation_for_alters: true

# ============================================================
#  FRONTEND RULES (React)
# ============================================================

frontend_rules:
  folder_structure:
    pages: "src/pages/[FeatureName]/"
    components: "src/components/"
    hooks: "src/hooks/"
    services: "src/services/"

  forms:
    library: react-hook-form
    validation: yup
    modal_layout_required: true
    auto_apply_audit_fields: true

  api:
    client: axiosApi
    include_error_wrapping: true

  ui:
    enforce_modal_layout: true
    table_layout_match_applicants: true
    report_layout_match_applicants: true
    dark_light_theme_required: true
    auto_detect_user_context: true

  logic:
    confirm_before_creating_conditional_fields: true
    preserve_existing_component_patterns: true
    prevent_unapproved_ui_patterns: true

# ============================================================
#  BACKEND RULES (Node / Express)
# ============================================================

backend_rules:
  folder_structure:
    routes: "backend/src/routes/"
    controllers: "backend/src/controllers/"
    models: "backend/src/models/"
    middleware: "backend/src/middleware/"

  db_calls:
    wrap_try_catch: true
    use_parameterized_queries: true
    auto_inject_who_columns: true
    tenant_filter_required: true

  rbac:
    enforce_module_level_access: true
    enforce_project_level_access: true
    follow_reference_rbac_structure: true

  responses:
    json_clean_format: true
    remove_internal_fields: true
    protect_sensitive_info: true

# ============================================================
#  RBAC / MULTI-TENANCY
# ============================================================

rbac_rules:
  hierarchy_from_reference_project: true
  enforce_crud_permissions: true
  enforce_read_write_permissions: true
  enforce_hide_show_ui_permissions: true
  apply_user_module_access_table: true

tenant_isolation:
  field: center_id
  require_tenant_filter: true
  exception_roles: [AppAdmin, HQ]

# ============================================================
#  UNIVERSAL AUTO-AUDIT INJECTION
# ============================================================

cursor_injection_rules:
  alwaysApply: true
  inject_before_save:
    - |
      // AUTO-INJECT AUDIT FIELDS
      let userObj = {};
      try {
        userObj =
          JSON.parse(localStorage.getItem("authUser")) ||
          JSON.parse(localStorage.getItem("currentUser")) ||
          JSON.parse(localStorage.getItem("user")) ||
          {};
      } catch (e) {}

      const username =
        userObj?.username ||
        userObj?.name ||
        "system";

      if (editItem) {
        formData.updated_by = username;
        formData.updated_at = new Date().toISOString();
      } else {
        formData.created_by = username;
        formData.created_at = new Date().toISOString();
      }

# ============================================================
#  SMART NAMING CONVENTIONS
# ============================================================

smart_naming_conventions:
  enabled: true
  auto_confirm: true

  frontend:
    - Reports → "<EntityName>Report.jsx"
    - Modals → "<EntityName>Modal.jsx"
    - Tables → "<EntityName>Table.jsx"
    - Services → "<EntityName>Service.js"
    - Hooks → "use<EntityName>.js"
    - State → "<entityName>Slice.js"

  backend:
    - Controller → "<entityName>Controller.js"
    - Model → "<entityName>Model.js"
    - Route File → "<entityName>Routes.js"
    - Middleware → "<entityName>Middleware.js"

# ============================================================
#  VALIDATION & TESTING
# ============================================================

validation:
  validate_only_changed_files: true
  skip_static_analysis_on_small_changes: true
  prevent_schema_breakage: true

testing_rules:
  frontend: ["React Testing Library", "Cypress"]
  backend: ["Jest", "Supertest"]
  require_rbac_test_coverage: true

# ============================================================
#  DESIGN CONSISTENCY
# ============================================================

ui_guidelines:
  match_reference_project: true
  modal/table/report_standardization: mandatory
  respect_spacing_typography: true
  require_theme_support: true
  avoid_unapproved_custom_designs: true

# ============================================================
#  AI COMMUNICATION RULES
# ============================================================

ai_clarification_templates:
  tone: "Professional and direct"
  ask_before_actions:
    - When RBAC impact uncertain
    - When schema impact unclear
    - When UI structure differs from Applicants
    - When creating new modules/features
    - When altering existing logic

refusal_guidelines:
  - "Skipping to avoid breaking existing logic. Confirm if override is required."

communication_guidelines:
  - Always clarify uncertainty before committing changes
  - Avoid long explanations; prioritize direct actions
  - Behave like a senior tech lead
  - Example prompts:
      - "Do you want same modal layout as Applicants?"
      - "Should RBAC apply same as CaseWorker + OrgAdmin?"
      - "Confirm tenant filtering for this endpoint?"

# ============================================================
#  PERFORMANCE SUMMARY
# ============================================================

performance_summary:
  optimization_level: aggressive
  prefer_speed_over_explanation: true
  confirm_major_changes_only: true
  enable_backend_indexing: true
