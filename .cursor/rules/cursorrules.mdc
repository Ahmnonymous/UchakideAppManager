---
alwaysApply: true
---
# ============================================================

# üîπ GLOBAL CURSOR RULESET - UCHAKIDE APP MANAGER (v5.3)

# ============================================================

runtime:
priority_mode: performance
disable_full_context_analysis: true

meta:
name: "Uchakide App Manager Ruleset"
version: 5.3
description: |
Cursor AI ruleset updated for the Uchakide App Manager project.
Fully generic database rules, modal pages, and reference to Applicants module.
Designed for React + Node/Express + PostgreSQL projects.

performance:
cache_scans: true
cache_reasoning: true
cache_schema_map: true
incremental_analysis: true
max_context_depth: 3
skip_validation_if_unchanged: true

reasoning:
depth_limit: 3
skip_noncritical_checks: true
auto_trust_known_patterns: true

ai_behavior:
verbosity: low
infer_context_from_path: true
skip_restatement: true

# ============================================================

# üîπ CORE DEVELOPMENT PRINCIPLES

# ============================================================

general_guidelines:

* Maintain design + logic uniformity across any project.
* Use existing production-ready project and Applicants module as reference for component structure, API design, and schema style.
* Use **modal pages** for all forms and detail views instead of drawers.
* Do not overwrite existing production projects.
* Use structured reasoning: confirm flow ‚Üí confirm RBAC ‚Üí then generate.
* Follow same layout pattern for modals, tables, forms, and report pages.
* Ensure dark/light theme compatibility.
* Always include audit metadata (`created_by`, `updated_by`, timestamps) for all tables.

# ============================================================

# üîπ SCHEMA / DATABASE RULES (GENERIC)

# ============================================================

database_rules:
auto_who_columns: true
who_columns: [created_by, created_at, updated_by, updated_at]
schema_generation:
style: replicate_existing_schema
table_creation_rules:
- Follow reference project naming and style for all new tables
- Enforce primary keys, foreign keys, and indexes consistently
- Sub-tables linked to parent tables automatically if parent-child relationship exists
- Optional fields clearly marked
- Comments auto-generated to describe table purpose and relationships
- Data types consistent with PostgreSQL best practices
foreign_keys: true
indexes: replicate_existing_schema_style
constraints: replicate_existing_schema_style
sub_table_links: true
optional_fields: clearly_marked
comments: auto_generate_with_description

# ============================================================

# üîπ FRONTEND RULES

# ============================================================

frontend_rules:

* Place pages under src/pages/[FeatureName]/
* Reusable components ‚Üí src/components/
* React Hook Form for inputs
* Use axiosApi for backend calls
* Auto-apply audit fields in forms
* Maintain **modal**, table, report layout consistency
* Auto-detect user info from localStorage / Redux / Context
* Ask before creating/changing conditional fields
* Auto-apply dark/light themes
* Replicate component structure, naming, and layout from **Applicants module**

# ============================================================

# üîπ BACKEND RULES

# ============================================================

backend_rules:

* Standard folders:
  routes ‚Üí backend/src/routes/
  controllers ‚Üí backend/src/controllers/
  models ‚Üí backend/src/models/
* Wrap DB calls in try/catch
* Use parameterized queries
* Auto-inject WHO columns for all tables
* Enforce RBAC based on module-level and project-level access
* Tenant isolation (req.user.center_id) except for AppAdmin/HQ
* Return clean JSON
* Maintain audit consistency

# ============================================================

# üîπ RBAC HIERARCHY

# ============================================================

rbac_rules:

* Use same role logic as existing production project
* Enforce CRUD / Read/Write / Hide/Show per module based on UserModuleAccess
* Enforce project-level access via ProjectRoles
* Apply module-level access to all modules

# ============================================================

# üîπ AUTO AUDIT FIELD INJECTION

# ============================================================

cursor_injection_rules:
alwaysApply: true
inject_before_save:
- |
// üîπ UNIVERSAL AUTO-AUDIT HANDLER FOR APP MANAGER
let currentUser;
try {
currentUser =
JSON.parse(localStorage.getItem("authUser")) ||
JSON.parse(localStorage.getItem("currentUser")) ||
JSON.parse(localStorage.getItem("user")) ||
{};
} catch (e) { currentUser = {}; }

```
  const username = currentUser?.username || currentUser?.name || "system";

  if (editItem) {
    formData.updated_by = username;
    formData.updated_at = new Date().toISOString();
  } else {
    formData.created_by = username;
    formData.created_at = new Date().toISOString();
  }
```

# ============================================================

# üîπ SMART NAMING CONVENTIONS

# ============================================================

smart_naming_conventions:
enabled: true
auto_confirm: true
rules:
frontend:
- Report pages ‚Üí <EntityName>Report.jsx
- Detail views ‚Üí <EntityName>Modal.jsx
- Tables ‚Üí <EntityName>Table.jsx
- Services ‚Üí <EntityName>Service.js
- Redux/context ‚Üí <entityName>Slice.js
backend:
- Controller ‚Üí <entityName>Controller.js
- Model ‚Üí <entityName>Model.js
- Routes ‚Üí <entityName>Routes.js
- Middleware ‚Üí <entityName>Middleware.js

# ============================================================

# üîπ VALIDATION & TESTING

# ============================================================

validation:
full_project_scan: false
validate_only_changed_files: true
skip_static_analysis_on_small_changes: true

testing_rules:

* Frontend ‚Üí React Testing Library + Cypress
* Backend ‚Üí Jest + Supertest
* Run lint + tests before commit
* Verify RBAC, WHO columns, and tenant filtering

# ============================================================

# üîπ DESIGN CONSISTENCY

# ============================================================

ui_guidelines:

* Match layout, spacing, typography, and modal/table/report structure from reference project
* Maintain card/table/report consistency
* Confirm dark/light modes
* Ask user before creating new UI patterns

# ============================================================

# üîπ AI CLARIFICATION & COMMUNICATION

# ============================================================

ai_clarification_templates:
tone: "Professional, direct"
ask_before_actions:
- Only ask when module type, folder, or RBAC logic is ambiguous
confirmation_examples:
- ‚ÄúConfirm same layout as Applicants module?‚Äù
refusal_guidelines:
- ‚ÄúSkipping to avoid breaking existing logic ‚Äî confirm if override needed.‚Äù

communication_guidelines:

* Always clarify uncertainty before action
* Prioritize accuracy and consistency over speed
* Use same tone across backend and frontend
* Speak as a proactive senior dev
* Example phrasing:

  * ‚ÄúTo confirm, should this match your Applicant layout?‚Äù
  * ‚ÄúDo you want the same conditional visibility logic as UniversityDetails?‚Äù
  * ‚ÄúShould I auto-apply RBAC filters for OrgAdmin and Caseworker?‚Äù

performance_summary:
optimization_level: high
prefer_speed_over_explanation: true
confirm_major_changes_only: true
enable_background_indexing: true
